---
import TabToggle from "../components/TabToggle.astro";
import SectionLayout from "../layouts/SectionLayout.astro";
import { tabItems } from "../utils/constants";
import PhoneDotLoader from "../components/PhoneDotLoader.astro";

export const patientConvo_pt1 = [
	{ speaker: "AI", text: "Hello, you’ve reached the GP Centre." },
	{ speaker: "AI", text: "Could you confirm your full name, please?" },
	{ speaker: "Patient", text: "Luke Davis." },
	{ speaker: "AI", text: "Thanks, Luke." },
	{ speaker: "AI", text: "And your date of birth, please?" },
	{ speaker: "Patient", text: "15th of March, 1985." },
];

export const patientConvo_pt2 = [
	{ speaker: "AI", text: "Thank you, Luke." },
	{ speaker: "AI", text: "How can I help?" },
	{ speaker: "Patient", text: "I've been having headaches on and off." },
	{ speaker: "Patient", text: "For the past few weeks." },
];

export const patientConvo_pt3 = [
	{ speaker: "AI", text: "I'm sorry to hear that, Luke." },
	{ speaker: "AI", text: "Let's get you booked in" },
	{ speaker: "AI", text: "With Dr. Lee as soon as we can." },
	{ speaker: "AI", text: "Would Wednesday at 11:00 in the morning work?" },
	{ speaker: "Patient", text: "Yes, that works." },
	{ speaker: "AI", text: "Great. I'll book you in." },
];

export const patientConvo_pt4 = [
	{ speaker: "AI", text: "Alright, Luke." },
	{ speaker: "AI", text: "You'll receive a confirmation text." },
	{ speaker: "AI", text: "And a feedback form shortly." },
	{ speaker: "Patient", text: "Thanks." },
];

export const patientConvo_pt5 = [
	// { speaker: "AI", text: "Thanks, Sarah." },
	{ speaker: "AI", text: "Is there anything else I can help you with?" },
	{ speaker: "Patient", text: "No, that was all." },
	// { speaker: "Patient", text: "Thank you." },
	{ speaker: "AI", text: "Take care." },
	{ speaker: "AI", text: "Bye." },
	// { speaker: "Patient", text: "Bye." },
];

export const convoLoadingText = [
	["Verifying…", "Verified"],
	["Analysing…", ""],
	["Booking…", "Booked"],
	["Sending…", "Sent"],
];
---

<script>
	// if isIOS, add --isIOS to classname

	import { isIOS } from "../utils/helpers";

	const PhoneSection__inner = document.querySelector(".PhoneSection__inner")!;
	if (isIOS()) {
		PhoneSection__inner.classList.add("PhoneSection__inner--isIOS");
	}

	const muteBtn = document.querySelector(".PhoneSection__muteBtn")!;
	const audioEls = document.querySelectorAll(
		".PhoneSection__audio"
	) as NodeListOf<HTMLAudioElement>;

	muteBtn.addEventListener("click", () => {
		if (audioEls[0].muted) {
			audioEls.forEach((audio) => {
				audio.muted = false;
			});

			muteBtn.classList.add("PhoneSection__muteBtn--isUnmuted");
			muteBtn.querySelector("span")!.textContent = "Mute";
			// hange icon
			muteBtn
				.querySelector("svg > path")!
				.setAttribute(
					"d",
					"M2 16.0001H5.88889L11.1834 20.3319C11.2727 20.405 11.3846 20.4449 11.5 20.4449C11.7761 20.4449 12 20.2211 12 19.9449V4.05519C12 3.93977 11.9601 3.8279 11.887 3.73857C11.7121 3.52485 11.3971 3.49335 11.1834 3.66821L5.88889 8.00007H2C1.44772 8.00007 1 8.44778 1 9.00007V15.0001C1 15.5524 1.44772 16.0001 2 16.0001ZM23 12C23 15.292 21.5539 18.2463 19.2622 20.2622L17.8445 18.8444C19.7758 17.1937 21 14.7398 21 12C21 9.26016 19.7758 6.80629 17.8445 5.15557L19.2622 3.73779C21.5539 5.75368 23 8.70795 23 12ZM18 12C18 10.0883 17.106 8.38548 15.7133 7.28673L14.2842 8.71584C15.3213 9.43855 16 10.64 16 12C16 13.36 15.3213 14.5614 14.2842 15.2841L15.7133 16.7132C17.106 15.6145 18 13.9116 18 12Z"
				);
		} else {
			audioEls.forEach((audio) => {
				audio.muted = true;
			});
			muteBtn.classList.remove("PhoneSection__muteBtn--isUnmuted");
			muteBtn.querySelector("span")!.textContent = "Unmute";
			// change icon to unmute
			muteBtn
				.querySelector("svg > path")!
				.setAttribute(
					"d",
					"M5.88889 16.0001H2C1.44772 16.0001 1 15.5524 1 15.0001V9.00007C1 8.44778 1.44772 8.00007 2 8.00007H5.88889L11.1834 3.66821C11.3971 3.49335 11.7121 3.52485 11.887 3.73857C11.9601 3.8279 12 3.93977 12 4.05519V19.9449C12 20.2211 11.7761 20.4449 11.5 20.4449C11.3846 20.4449 11.2727 20.405 11.1834 20.3319L5.88889 16.0001ZM20.4142 12.0001L23.9497 15.5356L22.5355 16.9498L19 13.4143L15.4645 16.9498L14.0503 15.5356L17.5858 12.0001L14.0503 8.46454L15.4645 7.05032L19 10.5859L22.5355 7.05032L23.9497 8.46454L20.4142 12.0001Z"
				);
		}
	});
</script>

<div class="PhoneSection__title">
	<h1 class="specialH1">
		This is the <span style="font-weight: 700;">Call</span>
	</h1>
	<h1 class="">Powered entirely by inCall</h1>
</div>

<div class="PhoneSection__wrap">
	<audio controls muted class="PhoneSection__audio PhoneSection__audio--1">
		<source
			src="https://res.cloudinary.com/dywp91yx7/video/upload/v1746625135/folio-v2/ladybird-part-1.mp3"
			type="audio/mpeg"
		/>
	</audio>
	<audio controls muted class="PhoneSection__audio PhoneSection__audio--2">
		<source
			src="https://res.cloudinary.com/dywp91yx7/video/upload/v1746625768/folio-v2/ladybird-part-2.mp3"
			type="audio/mpeg"
		/>
	</audio>
	<audio controls muted class="PhoneSection__audio PhoneSection__audio--3">
		<source
			src="https://res.cloudinary.com/dywp91yx7/video/upload/v1746630795/folio-v2/ladybird-part-3.mp3"
			type="audio/mpeg"
		/>
	</audio>
	<audio controls muted class="PhoneSection__audio PhoneSection__audio--4">
		<source
			src="https://res.cloudinary.com/dywp91yx7/video/upload/v1746140775/folio-v2/ladybird-part-4.mp3"
			type="audio/mpeg"
		/>
	</audio>
	<audio controls muted class="PhoneSection__audio PhoneSection__audio--5">
		<source
			src="https://res.cloudinary.com/dywp91yx7/video/upload/v1746140791/folio-v2/ladybird-part-5.mp3"
			type="audio/mpeg"
		/>
	</audio>
	<img src="/images/iphone-shadow.jpg" alt="Phone" class="PhoneSection__bg" />
	<!-- <p class="PhoneSection__wrap__time">09:28</p> -->
	<div class="PhoneSection__inner">
		<PhoneDotLoader />
		<div class="PhoneSection__convoWrap">
			<div class="PhoneSection__fakeConvoPart"></div>
			{
				[
					patientConvo_pt1,
					patientConvo_pt2,
					patientConvo_pt3,
					patientConvo_pt4,
					patientConvo_pt5,
				].map((convoPart) => (
					<div class="PhoneSection__convoPart">
						{convoPart.map((convoItem) => (
							<div class="PhoneSection__convo">
								<p
									class={`PhoneSection__convo__text PhoneSection__convo__text--${convoItem.speaker}`}
								>
									{convoItem.text}
								</p>
								{/* <div class="PhoneSection__convo__cursor" /> */}
							</div>
						))}
					</div>
				))
			}
			{
				convoLoadingText.map((convoItem) => (
					<div class="PhoneSection__loadingPart">
						{convoItem.map((item) => (
							<div class="PhoneSection__loading">
								<p class={`PhoneSection__loading__text`}>{item}</p>
							</div>
						))}
					</div>
				))
			}
		</div>
	</div>
</div>

<style lang="scss" scoped>
	.PhoneSection {
		&__audio {
			display: none;
		}

		&__title {
			margin-top: 1.5rem;
			margin-bottom: 1.5rem;

			.specialH1 {
				font-family: "SF Pro Display", Arial, sans-serif;
				font-size: 4rem;
				font-weight: 600;
				// color: #ff0000;
			}

			h1 {
				font-size: 2rem;
				font-weight: 400;
				line-height: 1.1;
				text-align: center;
				font-family: "Patrick Hand SC";
			}
		}

		&__bg {
			height: 100%;
			max-height: 80vh;

			width: 100%;
			max-width: 100vw;
			object-fit: contain;
		}

		&__wrap {
			position: relative;
			width: max-content;
			height: calc(100dvh - 180px);
			// margin-top: 1.2rem;

			&__time {
				position: absolute;
				top: 4.8vh;

				left: 7vh;
				font-size: 1.5vh;
				font-weight: 700;
			}
		}
		&__inner {
			// max-height: 80vh;
			position: absolute;
			top: 0;
			left: 0;

			width: 100%;
			height: 100%;
			padding: 1rem 4rem;

			display: flex;
			flex-direction: column;
			align-items: center;
			justify-content: center;
			gap: 2rem;
		}

		&__convoPart,
		&__loadingPart,
		&__fakeConvoPart {
			height: 0;
			overflow: hidden;
		}
		&__convoPart:first-of-type {
			height: 6rem;
		}

		&__loading,
		&__convo {
			position: relative;

			&__text {
				font-size: 1rem;
				line-height: 1.5;
				color: #333;
				margin: 0;
				padding: 0;
				transition: all 0.5s;
				text-align: center;

				overflow: hidden;

				&--Patient {
					// font-weight: 700;
				}

				& > .word {
					// width: 0;
				}

				.char {
					width: 0;
					opacity: 0;
				}
			}
		}
	}

	@media (max-width: 768px) {
		.PhoneSection {
			&__title {
				gap: 0;
				.specialH1 {
					font-size: 2.5rem;
				}

				h1 {
					font-size: 1.2rem;
					line-height: 1;
				}
			}

			&__bg {
				max-height: 90vh;
			}

			&__wrap {
				height: calc(100dvh - 170px);
			}

			&__inner {
				padding: 1rem 7rem;
				// padding: 1rem clamp(0px, 7vh, 7rem);
			}

			&__loading,
			&__convo {
				&__text {
					// font-size: 0.8rem;
					font-size: clamp(8px, 1.8vh, 0.8rem);
				}
			}
		}
	}
	@media (max-width: 768px) and (pointer: coarse) {
		.PhoneSection {
			&__wrap--isIOS {
				height: calc(100dvh - 140px);
				// height: calc(100dvh - 216px);
			}

			&__inner--isIOS {
				// padding: 1rem 6rem;
			}
		}
	}
</style>
